<div class="container mt-3">
  <h2>Order Management</h2>

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <label for="statusFilter">Filter by Status:</label>
      <select id="statusFilter" [(ngModel)]="selectedStatus" (change)="onStatusChange()" class="form-select w-auto d-inline-block">
        <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
      </select>
    </div>
  </div>

  <div *ngIf="loading" class="text-center mt-3">
    <p>Loading orders...</p>
  </div>

  <table *ngIf="!loading && orders.length > 0" class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>User</th>
        <th>Total</th>
        <th>Status</th>
        <th>Created</th>
        <th>Items</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let order of orders">
        <td>{{ order.id }}</td>
        <td>{{ order.userName }}</td>
        <td>{{ order.totalAmount | currency:'BDT' }}</td>
        <td><span class="badge bg-info text-dark">{{ order.status }}</span></td>
        <td>{{ order.createdAt | date:'short' }}</td>
        <td>
          <ul class="mb-0">
            <li *ngFor="let item of order.items">
              {{ item.menuItemName }} (x{{ item.quantity }}) - {{ item.unitPrice | currency:'BDT' }}
            </li>
          </ul>
        </td>
        <td>
          <div class="btn-group" role="group">
            <button *ngIf="order.status === 'PENDING'" class="btn btn-sm btn-success" (click)="updateStatus(order, 'CONFIRMED')">Confirm</button>
            <button *ngIf="order.status === 'CONFIRMED'" class="btn btn-sm btn-warning" (click)="updateStatus(order, 'PREPARING')">Prepare</button>
            <button *ngIf="order.status === 'PREPARING'" class="btn btn-sm btn-primary" (click)="updateStatus(order, 'IN_PROGRESS')">Start</button>
            <button *ngIf="order.status === 'IN_PROGRESS'" class="btn btn-sm btn-info" (click)="updateStatus(order, 'COMPLETED')">Complete</button>
            <button *ngIf="order.status !== 'COMPLETED' && order.status !== 'CANCELLED'" class="btn btn-sm btn-danger" (click)="updateStatus(order, 'CANCELLED')">Cancel</button>
            <button class="btn btn-sm btn-outline-danger" (click)="deleteOrder(order.id)">Delete</button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="!loading && orders.length === 0" class="text-center mt-4">
    <p>No orders found for status "{{ selectedStatus }}"</p>
  </div>
</div>

