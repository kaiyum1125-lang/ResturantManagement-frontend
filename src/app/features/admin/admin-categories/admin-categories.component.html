<div>
    <app-sidebar></app-sidebar>
</div>
<div class="page-container">

    <div class="admin-categories">
        <!-- Header -->
        <div class="page-header">
            <div class="header-content">
                <h1 class="page-title">
                    <i class="bi bi-tags"></i>
                    Categories Management
                </h1>
                <p class="page-subtitle">Organize your menu with categories</p>
            </div>
            <button class="btn btn-primary" (click)="openCategoryModal()">
                <i class="bi bi-plus-circle"></i>
                Add New Category
            </button>
        </div>

        <!-- Search -->
        <div class="search-section">
            <div class="search-box">
                <i class="bi bi-search"></i>
                <input type="text" placeholder="Search categories..." [(ngModel)]="searchTerm"
                    (input)="filterCategories()">
            </div>
            <div class="results-info">
                {{filteredCategories.length}} categories found
            </div>
        </div>

        <!-- Categories Grid -->
        <div class="categories-grid" *ngIf="filteredCategories.length > 0">
            <div *ngFor="let category of filteredCategories" class="category-card">
                <div class="category-header">
                    <h3 class="category-name">{{category.name}}</h3>
                    <div class="category-badge">
                        {{category.items?.length || 0}} items
                    </div>
                </div>

                <p class="category-description" *ngIf="category.description; else noDescription">
                    {{category.description}}
                </p>
                <ng-template #noDescription>
                    <p class="category-description empty">No description provided</p>
                </ng-template>

                <div class="category-stats">
                    <div class="stat">
                        <i class="bi bi-check-circle"></i>
                        <span>{{getAvailableItemsCount(category)}} available</span>
                    </div>
                    <div class="stat">
                        <i class="bi bi-clock"></i>
                        <span>{{getUnavailableItemsCount(category)}} unavailable</span>
                    </div>
                </div>

                <div class="category-actions">
                    <button class="btn btn-outline" (click)="viewCategoryItems(category)">
                        <i class="bi bi-eye"></i>
                        View Items
                    </button>
                    <button class="btn btn-primary" (click)="editCategory(category)">
                        <i class="bi bi-pencil"></i>
                        Edit
                    </button>
                    <button class="btn btn-danger" (click)="deleteCategory(category)" [disabled]="hasItems(category)">
                        <i class="bi bi-trash"></i>
                        Delete
                    </button>
                </div>

                <div class="delete-warning" *ngIf="hasItems(category)">
                    <i class="bi bi-exclamation-triangle"></i>
                    Contains {{category.items?.length}} items - cannot delete
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="filteredCategories.length === 0" class="empty-state">
            <i class="bi bi-tags"></i>
            <h3>No categories found</h3>
            <p>Try adjusting your search or add a new category to organize your menu.</p>
            <button class="btn btn-primary" (click)="openCategoryModal()">
                <i class="bi bi-plus-circle"></i>
                Add Your First Category
            </button>
        </div>

        <!-- Category Modal -->
        <div class="modal" [class.active]="showModal">
            <div class="modal-backdrop" (click)="closeModal()"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>{{isEditing ? 'Edit Category' : 'Add New Category'}}</h2>
                    <button class="btn-icon" (click)="closeModal()">
                        <i class="bi bi-x"></i>
                    </button>
                </div>

                <form [formGroup]="categoryForm" (ngSubmit)="saveCategory()">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="categoryName">Category Name *</label>
                            <input type="text" id="categoryName" formControlName="name"
                                placeholder="e.g., Appetizers, Main Course, Desserts">
                            <div class="error-message"
                                *ngIf="categoryForm.get('name')?.invalid && categoryForm.get('name')?.touched">
                                Category name is required and must be at least 2 characters.
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="categoryDescription">Description</label>
                            <textarea id="categoryDescription" formControlName="description" rows="4"
                                placeholder="Optional description for this category..."></textarea>
                        </div>

                        <!-- Category Stats -->
                        <div *ngIf="isEditing && selectedCategory" class="category-stats-preview">
                            <h4>Category Statistics</h4>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <span class="stat-value">{{selectedCategory.items?.length || 0}}</span>
                                    <span class="stat-label">Total Items</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">{{getAvailableItemsCount(selectedCategory)}}</span>
                                    <span class="stat-label">Available</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">{{getUnavailableItemsCount(selectedCategory)}}</span>
                                    <span class="stat-label">Unavailable</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline" (click)="closeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary" [disabled]="categoryForm.invalid || isSaving">
                            <i class="bi" [class.bi-check-circle]="!isSaving" [class.bi-arrow-clockwise]="isSaving"></i>
                            {{isSaving ? 'Saving...' : (isEditing ? 'Update Category' : 'Create Category')}}
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Category Items Modal -->
        <div class="modal" [class.active]="showItemsModal">
            <div class="modal-backdrop" (click)="closeItemsModal()"></div>
            <div class="modal-content large">
                <div class="modal-header">
                    <h2>Items in {{selectedCategory?.name}}</h2>
                    <button class="btn-icon" (click)="closeItemsModal()">
                        <i class="bi bi-x"></i>
                    </button>
                </div>

                <div class="modal-body">
                    <div *ngIf="selectedCategory?.items && selectedCategory?.items!.length > 0; else noItems"
                        class="items-list">
                        <div *ngFor="let item of selectedCategory?.items" class="item-card">
                            <img [src]="item.imageUrl || 'assets/default-food.jpg'" [alt]="item.name"
                                class="item-image">
                            <div class="item-details">
                                <h4 class="item-name">{{item.name}}</h4>
                                <p class="item-description">{{item.description || 'No description'}}</p>
                                <div class="item-meta">
                                    <span class="item-price">${{item.price}}</span>
                                    <span class="item-status" [ngClass]="item.available ? 'available' : 'unavailable'">
                                        {{item.available ? 'Available' : 'Unavailable'}}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <ng-template #noItems>
                        <div class="empty-state">
                            <i class="bi bi-inbox"></i>
                            <h3>No items in this category</h3>
                            <p>Start by adding menu items to this category.</p>
                        </div>
                    </ng-template>
                </div>
            </div>
        </div>
    </div>
</div>